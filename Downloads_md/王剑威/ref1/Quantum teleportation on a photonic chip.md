# Quantum teleportation on a photonic chip

Benjamin J. Metcalf $^{1\star}$ , Justin B. Spring $^{1}$ , Peter C. Humphreys $^{1}$ , Nicholas Thomas-Peter $^{1}$ , Marco Barbieri $^{1,2}$ , W. Steven Kolthammer $^{1}$ , Xian-Min Jin $^{1,3}$ , Nathan K. Langford $^{4}$ , Dmytro Kundys $^{5,6}$ , James C. Gates $^{5}$ , Brian J. Smith $^{1}$ , Peter G. R. Smith $^{5}$  and Ian A. Walmsley $^{1}$

Quantum teleportation is a fundamental concept in quantum physics<sup>1</sup> that now finds important applications at the heart of quantum technology, including quantum relays<sup>2</sup>, quantum repeaters<sup>3</sup> and linear optics quantum computing<sup>4,5</sup>. Photonic implementations have largely focused on achieving long-distance teleportation for decoherence-free quantum communication<sup>6-8</sup>. Teleportation also plays a vital role in photonic quantum computing<sup>4,5</sup>, for which large linear optical networks will probably require an integrated architecture. Here, we report a fully integrated implementation of quantum teleportation in which all key parts of the circuit—entangled state preparation, Bell-state analysis and tomographic state measurement—are performed on a reconfigurable photonic chip. We also show that a novel element-wise characterization method is critical to the mitigation of component errors, a key technique that will become increasingly important as integrated circuits reach the higher complexities necessary for quantum enhanced operation.

Quantum teleportation is essential to many schemes for universal fault-tolerant quantum computation, making it an important protocol for any physical implementation of a quantum information processor[9,10]. In their seminal work, Knill, Laflamme and Milburn showed that such a quantum processor could be constructed using only linear optical elements, at the expense of rendering each quantum logic gate probabilistic[4]. Adapting the teleportation scheme of Gottesman and Chuang[5], they then showed that this protocol could be efficiently scaled to a large number of concatenated gates, motivating a renewed interest in building more complex linear optical circuits for quantum information processing[10]. Realizing such a scheme requires building large, sophisticated networks of nested optical interferometers. This motivates the use of waveguides integrated onto compact and inherently stable photonic chips, and pioneering work has shown the viability of this approach for two-11-13 and three-photon interference experiments[14-16].

Although photonic experiments were the first to realize quantum teleportation $^{17,18}$ , demonstrations of this protocol in a waveguide architecture have been limited to fibre-based experiments $^{7,19}$ . Although, recently, there has been progress $^{20}$ , no integrated photonic experiments have yet been able to demonstrate actual teleportation due to the difficulty in realizing three photonic qubits on a sufficiently complex circuit $^{14}$ . In particular, integrated components require careful attention to fabricated deviations from design and the effects of increased and potentially unbalanced propagation loss. Experimental verification that integrated photonic circuits continue to perform well as their complexity increases is therefore of considerable interest.

In this Letter, we demonstrate teleportation of a photonic qubit on an integrated waveguide device. We use a reconfigurable photonic chip to perform the teleportation protocol with state encoding, entanglement preparation, Bell-state analysis and state tomography, all carried out on chip. We develop a theoretical model to account for all sources of possible error in the circuit and find good agreement with the measured teleported state fidelities, which exceed the average teleportation fidelity possible with a classical device. We identify the elements of this error budget relevant to scaling and find that improvements to chip characterization and fabrication will be required to achieve high-fidelity operation. The combination of high-heralding-efficiency single-photon sources, a low-loss silica waveguide architecture, as well as a careful element-wise characterization of the fabricated device are key to successful operation.

The quantum teleportation circuit, shown in Fig. 1a, aims to transfer the quantum state of an input qubit Q1 to the target qubit Q3. The protocol begins by generating a maximally entangled photonic resource, a Bell state, encoded on qubits Q2 and Q3. A two-qubit Bell state measurement (BSM) is then performed on input Q1 and one half of the entangled state (Q2). This measurement projects the target qubit Q3 onto the original input state via the correlations of the entangled pair, modulo one out of four fixed local unitary rotations. The teleportation protocol is complete once the result of this measurement is communicated to the party holding Q3, leaving this state informationally equivalent to that originally coded on Q1. The specific unitary rotation needed to re-align the basis of Q3 with that of the initial state can be identified by two classical bits describing the outcome of the BSM, although this unitary operation is not necessary to prove that quantum teleportation has taken place<sup>7</sup>. In theory, this results in the unit-fidelity transfer of the initial unknown quantum state from Q1 to Q3 without any information being revealed about the state itself. Without the resource of entanglement or knowledge of the input state, the best achievable average fidelity is only  $2/3$  (ref. 21).

In the present experiment, although the final feed-forward rotation could in principle be implemented using the on-chip phase shifters  $\phi_{2}$  and  $\theta_{2}$ , in reality these shifters do not have sufficiently rapid response to make this feasible. Instead, we use these phase shifters to perform quantum state tomography (QST) of the teleported qubit Q3 and replace the final physical rotation by an entirely equivalent numerical rotation in post-processing. Directly implementing feed-forward in standard integrated optics chips is a major open challenge requiring ultrafast on-chip photon detection, classical electronics, feed-forward and phase modulation, all operating at terahertz bandwidths. Recently, progress towards integrated high-speed photon detectors[22], fast phase control based on

![](images/2e8d30e65194fd5f39260f1ee897db368b865ea295211efc472c4cc45bf1d194.jpg)

![](images/777e41717ba16b73841263a780f344ea3a722ac8dd7a1962c1ec80ac1a88362e.jpg)

![](images/e84977662cd8cae9504ea688679c22a05003d2fd5be45c211a6b26db18e16c07.jpg)  
Figure 1 | Quantum teleportation and photonic chip realization. a, Circuit diagram of a general quantum teleportation scheme. b, In the present experiment we replace the two CNOT gates with two C-PHASE gates and additional local Hadamard operations. The results of the Bell state measurement (BSM) are used in post-processing as part of quantum state tomography to recover the teleported qubit. c, In the on-chip realization, three qubits are encoded using dual-rail logic in a silica-on-silicon integrated chip. Local Hadamard operations (H1 to H4) are performed using beamsplitters of reflectivity  $1/2$  (solid lines) and the two cascaded C-PHASE gates (CZ1, CZ2) are implemented using four beamsplitters of reflectivity  $1/3$  (dashed lines). State preparation and tomography are performed on chip using thermo-optically controlled phases  $\theta$  and  $\phi$ .

strain-optic $^{23}$  and electro-optic $^{24}$  effects, and efficient on-chip delays $^{25}$  has been demonstrated.

The waveguide circuit encodes three qubits using a dual-rail scheme, as shown in Fig. 1c. In this scheme, a single photon in the top rail represents the logical state  $|0_{\mathrm{L}}\rangle = \hat{a}^{\dagger}|\mathrm{vac}\rangle = |10\rangle_{a,b}$  whereas one photon in the lower mode represents the logical state  $|1_{\mathrm{L}}\rangle = \hat{b}^{\dagger}|\mathrm{vac}\rangle = |01\rangle_{a,b}$ . Deterministic single-qubit operations are realized using linear beamsplitters[26] and thermo-optic phase shifters[12] and allow us to implement reconfigurable single qubit unitary rotations,  $\hat{U} (\theta ,\phi) = e^{-i\phi \hat{\sigma}_{z} / 2}e^{-i\theta \hat{\sigma}_{y} / 2}$  (see Methods).

The concatenated C-PHASE gates in the circuit are implemented using the probabilistic scheme proposed by Ralph $^{27}$ . In this scheme, effective two-photon interactions are induced via post-selection of one photon being detected in each of the three qubit modes. This occurs with probability 1/27, which sets the overall success probability of the circuit.

We now describe the main experiment showing on-chip quantum teleportation. Three single photons generated by two parametric downconversion sources are coupled into the ultraviolet (UV)-written, silica-on-silicon photonic chip (see Supplementary Sections I and V, Fig. 4). An array of six avalanche photodiodes (APDs) monitor all output modes. We identify successful teleportation events as runs in which one photon is detected for each of the three qubits, as well as in an ancillary heralding arm. Fourfold detection coincidences are registered using a field-programmable gate array (FPGA). Data are collected for three linearly independent input states,  $|\psi_{\mathrm{in}}\rangle = \hat{U} (\theta_1,\phi_1)|0_{\mathrm{L}}\rangle$ , coded on Q1 by appropriately setting  $\theta_{1}$  and  $\phi_{1}$ . For each input state,  $\theta_{2}$  and  $\phi_{2}$  are adjusted to perform projective measurements of Q3 in three different bases, allowing us to reconstruct the teleported state via maximum-likelihood tomography.

Each input state is teleported to one of four possible output states depending on the outcome of the BSM:  $|\psi_{\mathrm{out}} \rangle = U_i |\psi_{\mathrm{in}} \rangle$ , where the rotation  $U_i$  is uniquely determined by the BSM outcome. For an ideal circuit,  $U_i$  corresponds to an element of  $\{\hat{\sigma}_z, 1, i \hat{\sigma}_y, \hat{\sigma}_x\}$ .

A realistic circuit deviates from the ideal case due to fabrication imperfections. In general, the rotations that optimize the teleportation fidelity must be found by characterizing the actual device. To do so, we use a numerical model to simulate the teleported output state at the point immediately prior to the QST stage on Q3. The simulation uses ideal indistinguishable Fock-state inputs and critically relies on being able to perform an element-wise characterization of our circuit in order to remove the effects of the on-chip state encoding and tomography stages from this analysis (see Methods). We then numerically find the unitary rotations,  $U_{i}^{\prime}$ , which maximize the average output state fidelity over 10,000 randomly chosen input states. We note that the resulting rotations are found independently of the primary experimental data and depend only on the classical circuit characterization. To verify successful teleportation, we numerically apply these predetermined rotations to the reconstructed state of Q3,  $\hat{\rho}_{\mathrm{out}}$ , and calculate the fidelity to the input states,  $\mathcal{F} = \langle \psi_{\mathrm{in}}|\hat{U}_i^\prime \hat{\rho}_{\mathrm{out}}\hat{U}_i^{\dagger}|\psi_{\mathrm{in}}\rangle$ . Although it is not possible to achieve high-efficiency teleportation without fast feed-forward, using this post-selective approach allows us to easily confirm the success of our experiment for each classical BSM outcome.

The teleportation results for the BSM outcome  $|\Psi^{+}\rangle$  are summarized in Fig. 2. The experiment was performed using three linearly independent input states close to the three orthogonal axes of the Bloch sphere (see Supplementary Section III). We label them  $|V^{\prime}\rangle$ ,  $|D^{\prime}\rangle$  and  $|L^{\prime}\rangle$ , according to the closest lying axis state (Fig. 2a-c). Fourfold coincidences were registered in a specific BSM outcome at  $\sim 5\mathrm{mHz}$  and around 100 coincidence counts were collected for each measurement setting and BSM outcome. The initial input states are recovered with an average fidelity of  $89\pm 3\%$ , which exceeds the classical limit of  $2/3$  by more than six standard deviations[21]. Because any state on the Bloch sphere is a linear combination of these three states, the results are sufficient to conclude that this chip is capable of teleporting general quantum states with high fidelity. The results from all four BSM outcomes are

![](images/251682c3b35781de31e05c2b6e61031674d182f16c75948f9ff76a1edf44eecc.jpg)  
a

![](images/a7a27ff32eb004817b475123addee83f2001643e55bdaa1f7cebdbbc560440fd.jpg)  
b

![](images/c19c1f90516830cf149a8548d95c072169053cf4fedd2c3449a80391b9b722aa.jpg)  
c

![](images/d5e198c4e7ce117efc365279e54ca41f0dfeeca5c3cb074c722735794830645a.jpg)

![](images/d634b04ceebb0f8ba6ef32fd03a2e8b38770a51ca232542a52a7f39aba9d7f30.jpg)

![](images/dddcd51db2674d0ce7fe1d425846074de494a5ffe074082ee305fa8348533076.jpg)

![](images/3b55bfe63f44d8e9abc274d6392c674cdc8d6a40157754979706d2dabfb1ce01.jpg)  
Figure 2 | Reconstructed density matrices of the teleported states. a-c, The initial qubit states on Q1 for each of three trials are depicted on the Bloch sphere (top) and as real and imaginary parts of a density matrix (black wire frames, middle and bottom, respectively). The final teleported states on Q3 are reconstructed using on-chip quantum state tomography and then transformed by optimal state-independent rotations in post-processing (coloured bars). The fidelity  $\mathcal{F}$  between the initial and final state shown is calculated (bottom). Representative data here are for experiments with a  $|\Psi^{+}\rangle$  Bell state measurement outcome. Similar reconstructed states for all four Bell state measurement outcomes are found in Supplementary Figs 1 and 2.

![](images/14eb570fec296e8cd08154396142e7c2b159a3260a07f9163759e11ead85fbd7.jpg)

![](images/fa75d2f113d4b8dac262ed90e4e6bb76c874166e327ff1d445706609f6cda2cf.jpg)

![](images/780566639af781c8cc43124671280cbf9b04bb3e4e83d1b8691f556c67004451.jpg)  
Bell state measurement outcomes  
Figure 3 | Measured and simulated fidelity of on-chip quantum teleportation. Measured fidelities of three teleported states  $(|V^{\prime}\rangle, |D^{\prime}\rangle$  and  $|L^{\prime}\rangle$ , from left to right) for each outcome of the Bell state measurement are plotted with circles. Errors are calculated using a Monte Carlo method taking account of Poissonian counting statistics and uncertainties in the characterized measurement operators and input states. Red shaded areas show the measured fidelity averaged over all three input states, which clearly exceeds the best average classical fidelity given by the red dotted line. The blue shaded areas show the predicted average fidelity taking into account imperfect circuit fabrication, higher-order photon emission and residual photon distinguishability. The error on these predictions is estimated using a Monte Carlo method over a range of different input states and model parameters.

shown in Fig. 3. In each case, the average fidelity for the three input states (shaded red boxes) is higher than the classical limit (dashed red line), irrespective of which classical outcome is obtained.

The sources responsible for the reduction in fidelity were investigated using a full theoretical model taking into account the experimentally characterized beamsplitter ratios and interferometer phases, higher-order photon emission, photon distinguishability and propagation losses (see Supplementary Section VIII). This model was used to calculate the expected click statistics on Q3 for given BSM outcomes and phase-shifter settings. These simulated clicks were substituted into our data analysis routine, including the appropriate unitary rotation, to predict the expected teleportation fidelity for different input states. This analysis reveals that the imperfect beamsplitting ratios decrease the degree of entanglement in the circuit, causing a reduction in the achievable fidelity to  $\sim 90\%$  that depends on the input state (see Supplementary Section VII). Non-ideal aspects of the photon source cause the remaining error. The predicted teleportation fidelities averaged over all input states are summarized in Fig. 3 as shaded blue boxes.

This error analysis highlights three key impediments to future scaling: photon sources, imperfect photonic chips and loss. Although the success of this experiment relies on our development of a high-quality single photon source, the absence of a true, high-purity, single-photon source continues to limit the achievable fidelity. This ubiquitous problem in quantum optics experiments is being addressed by the recent development of low-loss waveguided sources[28]. Also, moving to larger on-chip experiments will place stringent demands on photonic circuit performance. Fabricated beamsplitters and phase shifters will inevitably show some deviation from their designed parameters. Recent progress demonstrating

tighter control of fabricated optical components is promising $^{11,16}$ . However, as more components are integrated onto circuits, robust characterization methods together with active circuit control $^{11,12}$  will be required to identify, and then correct, remaining deviations from design.

In conclusion, we present the on-chip implementation of a three-qubit quantum circuit, successfully teleporting three linearly independent quantum states. We have modelled sources of error and their effect on the teleportation fidelity. This work shows that continuing advances in waveguide and photon source technology will be critical in addressing the challenges in achieving larger-scale linear-optical quantum computing—coping with the increased loss and identifying and correcting component errors.

# Methods

Device fabrication. The waveguide circuit used in this work was fabricated by the direct UV-writing technique utilizing silica slab waveguides deposited on a silicon substrate[12]. The individual waveguides were written by focusing a continuous-wave UV laser (wavelength,  $244\mathrm{nm}$ ) onto the germanium-doped silica photosensitive waveguide core and translating the laser beam transversely to the surface normal with computer-controlled two-dimensional motion. Waveguides (typically  $4.5\mu \mathrm{m} \times 4.5\mu \mathrm{m}$ ) were formed as a result of UV-induced permanent refractive index change inside the photosensitive waveguide core layer. The UV-writing process enables the creation of complex networks using compact X-couplers[26], the splitting ratio of which can be selected by adjusting the waveguide crossing angle during the UV-writing process. Compact X-couplers have a number of advantages over more traditional directional couplers, that is, compact footprint, low guiding loss and more stable coupling ratio[26]. The thermo-optic phase shifters utilize a small NiCr electrode ( $0.35\mu \mathrm{m} \times 50\mu \mathrm{m} \times 2.5\mathrm{mm}$ , electrical resistance =  $0.85\mathrm{k}\Omega$ ) deposited directly over one of the waveguides through which a current can be passed. The passive stability of the interferometers with the phase shifters set to a constant voltage was measured to be less than  $1^{\circ}$  over  $24\mathrm{h}$  and achieved a repeatability error of less than  $5^{\circ}$  when the voltage settings were changed.

Circuit characterization. The beamsplitter reflectivities and behaviour of the phase shifters were characterized to determine the unitary rotations and to correctly simulate the performance of the experiment. Recent proposals to characterize the behaviour of linear optical circuits have treated the devices as a 'black box', returning the overall transfer matrix of the network without reference to any information about the geometry of the underlying circuit[29,30]. For experiments using a reprogrammable circuit, however, it is critical to be able to characterize the individual linear optical elements so that it is not necessary to perform a full characterization for every configuration of the circuit. A full loss-tolerant characterization of the twelve beamsplitters was performed making use of transversely scattered light from the waveguide[14].

The on-chip state preparation and tomography elements each consist of two thermo-optic phase shifters embedded in a Mach-Zehnder interferometer. The phase shifters are situated close enough to one another that residual heat from one can slightly affect the other. The effect of this crosstalk must be characterized to accurately determine the behaviour of the circuit at different phase settings. Bright light was alternately coupled into the two input modes of Q1 while the power on the two output modes was monitored using photodiodes. The voltages applied to  $\theta_{1}$  and  $\phi_{1}$  were both varied to map out the two-dimensional response of the shifters on the effective phase change within their respective interferometers (see Supplementary Section VI and Fig. 7). A similar two-dimensional response was measured for the two phase shifters on Q3, and the zero-phase offset of the central interferometer on Q2 was also calculated. We found a small amount of crosstalk at the upper ranges of applied heater power, and account for this in our analysis.

Programmable unitary rotations. Generating and measuring arbitrary dual-rail qubit states requires control over only two parameters—a phase shift and a tunable beamsplitter,  $\hat{U}_{\mathrm{prepare}}(\phi_1,\theta_1) = e^{-i\phi_1\hat{\sigma}_z}e^{-i\theta_1\hat{\sigma}_y / 2}$  and  $\hat{U}_{\mathrm{measure}}(\phi_2,\theta_2) = e^{-i\theta_2\hat{\sigma}_y}e^{-i\phi_2\hat{\sigma}_z / 2}$  where  $\hat{\sigma}_{x,y,z}$  are the Pauli matrices. A tunable beamsplitter may be realized by embedding a phase shifter within a Mach-Zehnder interferometer (see Supplementary Section III and Fig. 3). In the ideal case, the MZI is composed of two  $\eta = 1 / 2$  beamsplitters. As the beamsplitter reflectivity deviates away from this ideal, we no longer implement a perfect tunable beamsplitter, restricting the range of accessible input states and measurement operators (see Supplementary Section III). The limited tuning range (see Supplementary Section IIIB) of our thermal phase shifters  $(0 < |\theta ,\phi |\lesssim 1.6)$  combined with our non-ideal beamsplitters restrict us to preparing and measuring quantum states over only one octant of the Bloch sphere.

Simulating teleportation fidelities. The expected click statistics of the photonic circuit were simulated by propagating input Fock states through a linear transfer matrix generated using the measured beamsplitter ratios and interferometer phase offsets. For a given input of  $N$  photons distributed across the three input modes, the output probability distribution of clicks was obtained by calculating the permanents

of specific  $N\times N$  submatrices of the transfer matrix (see Supplementary Section VIII). However, the photon sources used in this work generate two-mode squeezed states,  $|\Psi_{\mathrm{PDC}}\rangle = \sqrt{1 - \lambda^2}\sum_{n = 0}^{\infty}\lambda^n |nn\rangle$ . We thus model the input state as a mixture of the ideal three-photon Fock state input  $(|1,1,1\rangle)$  and the first set of higher-order terms  $(|1,2,2\rangle,|2,1,1\rangle)$ , weighted by the squeezing parameter of the photon sources measured via the conditional second-order correlation function  $(\lambda^2\approx 0.03)$ . The output probability distribution when one photon is distinguishable from the others is given by the incoherent sum of a single and an  $N - 1$  photon input (see Supplementary Section VIII). These output photon distributions are weighted by the distinguishability of our photon source through the measured reduction in expected Hong-Ou-Mandel dip visibility (see Supplementary Section VIII).

# Received 13 February 2014; accepted 15 August 2014; published online 14 September 2014

# References

1. Bennett, C. et al. Teleporting an unknown quantum state via dual classical and Einstein-Podolsky-Rosen channels. Phys. Rev. Lett. 70, 1895-1899 (1993).  
2. Jacobs, B., Pittman, T. & Franson, J. Quantum relays and noise suppression using linear optics. Phys. Rev. A 66, 052307 (2002).  
3. Briegel, H.-J., Dur, W., Cirac, J. & Zoller, P. Quantum repeaters: the role of imperfect local operations in quantum communication. Phys. Rev. Lett. 81, 5932-5935 (1998).  
4. Knill, E., Laflamme, R. & Milburn, G. A scheme for efficient quantum computation with linear optics. Nature 409, 46-52 (2001).  
5. Gottesman, D. & Chuang, I. L. Demonstrating the viability of universal quantum computation using teleportation and single-qubit operations. Nature 402, 390-393 (1999).  
6. Jin, X.-M. et al. Experimental free-space quantum teleportation. Nature Photon. 4, 376-381 (2010).  
7. Marcikic, I., de Riedmatten, H., Tittel, W., Zbinden, H. & Gisin, N. Long-distance teleportation of qubits at telecommunication wavelengths. Nature 421, 509-513 (2003).  
8. Ma, X.-S. et al. Quantum teleportation over 143 kilometres using active feed-forward. Nature 489, 269-273 (2012).  
9. Childs, A., Leung, D. & Nielsen, M. Unified derivations of measurement-based schemes for quantum computation. Phys. Rev. A 71, 032318 (2005).  
10. Kok, P., Nemoto, K., Ralph, T. C., Dowling, J. P. & Milburn, G. J. Linear optical quantum computing with photonic qubits. Rev. Mod. Phys. 79, 135-174 (2007).  
11. Shadbolt, P. J. et al. Generating, manipulating and measuring entanglement and mixture with a reconfigurable photonic circuit. Nature Photon. 6, 45-49 (2011).  
12. Smith, B. J., Kundys, D., Thomas-Peter, N., Smith, P. G. R. & Walmsley, I. A. Phase-controlled integrated photonic quantum circuits. Opt. Express 17, 13516-13525 (2009).  
13. Crespi, A. et al. Integrated photonic quantum gates for polarization qubits. Nature Commun. 2, 566 (2011).  
14. Metcalf, B. J. et al. Multiphoton quantum interference in a multiport integrated photonic device. Nature Commun. 4, 1356 (2013).  
15. Spring, J. B. et al. Boson sampling on a photonic chip. Science 339, 798-801 (2013).  
16. Crespi, A. et al. Integrated multimode interferometers with arbitrary designs for photonic boson sampling. Nature Photon. 7, 545-549 (2013).  
17. Bouwmeester, D. et al. Experimental quantum teleportation. Nature 390, 575-579 (1997).  
18. Boschi, D., Branca, S., Martini, F. D. & Hardy, L. Experimental realization of teleporting an unknown pure quantum state via dual classical and Einstein-Podolsky-Rosen channels. Phys. Rev. Lett. 80, 1121-1125 (1998).  
19. Nilsson, J. et al. Quantum teleportation using a light-emitting diode. Nature Photon. 7, 311-315 (2013).  
20. Martin, A., Alibart, O., Micheli, M. P. De., Ostrowsky, D. B. & Tanzilli, S. A quantum relay chip based on telecommunication integrated optics technology. New J. Phys. 14, 025002 (2012).  
21. Massar, S. & Popescu, S. Optimal extraction of information from finite quantum ensembles. Phys. Rev. Lett. 74, 1259-1263 (1995).  
22. Pernice, W. H. P. et al. High-speed and high-efficiency travelling wave single-photon detectors embedded in nanophotonic circuits. Nature Commun. 3, 1325 (2012).  
23. Humphreys, P. C. et al. Strain-optic active control for quantum integrated photonics. Preprint at http://arXiv.org/abs/1405.2694 (2014).  
24. Bonneau, D. et al. Fast path and polarization manipulation of telecom wavelength single photons in lithium niobate waveguide devices. Phys. Rev. Lett. 108, 053601 (2012).  
25. Lee, H., Chen, T., Li, J., Painter, O. & Vahala, K. J. Ultra-low-loss optical delay line on a silicon chip. Nature Commun. 3, 867 (2012).  
26. Kundys, D. O., Gates, J. C., Dasgupta, S., Gawith, C. B. E. & Smith, P. G. R. Use of cross-couplers to decrease size of UV written photonic circuits. IEEE Photon. Technol. Lett. 21, 947-949 (2009).  
27. Ralph, T. Scaling of multiple postselected quantum gates in optics. Phys. Rev. A 70, 012312 (2004).

28. Spring, J. B. et al. On-chip low loss heralded source of pure single photons. Opt. Express 21, 13522-13532 (2013).  
29. Rahimi-Keshari, S. et al. Direct characterization of linear-optical networks. Opt. Express 21, 13450-13458 (2013).  
30. Laing, A. & O'Brien, J. L. Super-stable tomography of any linear optical device. Preprint at http://arXiv.org/abs/1208.2868 (2012).

# Acknowledgements

The authors thank S. Tanzilli for comments on the manuscript. This work was supported by the Engineering and Physical Sciences Research Council (EPSRC projects EP/H03031X/1 and EP/C013956/1, programme grant EP/K034480/1 and platform grant EP/J008052/1), the European Commission project Simulations and Interfaces with Quantum Systems (SIQS), the Royal Society and the European Office of Aerospace Research and Development (EOARD) part of the Air Force Office of Scientific Research (AFOSR). X.-M.J. and W.S.K. are supported by European Commission Marie Curie fellowships (PIIF-GA-2011-300820 and PIEF-GA-2012-331859).

# Author contributions

B.J.M., J.B.S., P.C.H., N.T.-P., N.K.L. and I.A.W. all contributed to designing and setting up the experiment. B.J.M. performed the experiment. J.B.S. designed the FPGA electronics and helped with data taking. D.K. and J.C.G. fabricated the waveguide device. X-M.J., W.S.K., M.B., P.C.H., J.B.S. and B.J.M. all contributed to analysis of the data. B.J.M wrote the manuscript with input from all authors. B.J.S., P.G.R.S. and I.A.W. conceived the work and supervised the project.

# Additional information

Supplementary information is available in the online version of the paper. Reprints and permissions information is available online at www.nature.com/reprints. Correspondence and requests for materials should be addressed to B.J.M.

# Competing financial interests

The authors declare no competing financial interests.